{{!< default-author}}

<div class="gh-outer">
<main class="site-main gh-inner">

    {{#author}}
        <div class="term">
            {{> "author-box"}}
        </div>
    {{/author}}

    <div class="tabs-container">
        <ul class="tabs-list">
            {{! Tabs will be generated by JS }}
        </ul>
    </div>

    {{#get "posts" filter=(concat "author:" author.slug) include="tags" limit="all" as |author_posts|}}
        <div class="post-feed gh-feed">
        {{#foreach author_posts}}
            {{> "loop" }}
        {{/foreach}}
        </div>
    {{else}}
        <p>This author has no posts.</p>
    {{/get}}

</main>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const posts = document.querySelectorAll('.post-feed article');
    const tabsList = document.querySelector('.tabs-list');
    const tags = new Set();

    posts.forEach(post => {
        const postTags = post.dataset.tags ? post.dataset.tags.trim().split(' ') : [];
        postTags.forEach(tag => {
            if (tag) tags.add(tag);
        });
    });

    if (tabsList && tags.size > 0) {
        tabsList.innerHTML = '<li><button class="tab-button active" data-tag="all">All</button></li>';
        const sortedTags = Array.from(tags).sort();
        sortedTags.forEach(tag => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `<button class="tab-button" data-tag="${tag}" {{#if primary_tag.accent_color}} style="--tag-color: {{primary_tag.accent_color}};"{{/if}}>${tag.replace(/-/g, ' ')}</button>`;
            tabsList.appendChild(listItem);
        });

        const tabButtons = tabsList.querySelectorAll('.tab-button');

        function filterPosts(selectedTag) {
            posts.forEach(post => {
                const postTags = post.dataset.tags || '';
                if (selectedTag === 'all' || postTags.includes(selectedTag)) {
                    post.style.display = '';
                } else {
                    post.style.display = 'none';
                }
            });
            localStorage.setItem('activeAuthorTab', selectedTag);
        }

        tabsList.addEventListener('click', function (e) {
            if (e.target.classList.contains('tab-button')) {
                e.preventDefault();
                const selectedTag = e.target.dataset.tag;
                tabButtons.forEach(button => button.classList.remove('active'));
                e.target.classList.add('active');
                filterPosts(selectedTag);
            }
        });

        const savedTab = localStorage.getItem('activeAuthorTab');
        if (savedTab) {
            const savedTabButton = tabsList.querySelector(`[data-tag="${savedTab}"]`);
            if (savedTabButton) {
                tabButtons.forEach(button => button.classList.remove('active'));
                savedTabButton.classList.add('active');
                filterPosts(savedTab);
            }
        }
    } else if (tabsList) {
        tabsList.style.display = 'none';
    }
});
</script>

<style>
    .tabs-container {
        margin: 0 auto;
        margin-bottom: 20px;
        max-width: 840px;
    }
    .tabs-list {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .tab-button {
        /* From https://css.glass */
        background: var(--light-gray-color);
        border-radius: 16px;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(9.5px);
        -webkit-backdrop-filter: blur(9.5px);
        border: 1px solid rgba(129, 129, 129, 0.1);
        font-size: 1.2rem;
        text-transform: capitalize;
        cursor: pointer;
        
        /* padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 20px;
        background-color: var(--tag-color);
        font-size: 1.4rem; */
    }
    .tab-button.active {
        background-color: var(--ghost-accent-color);
        color: #fff;
        border-color: var(--ghost-accent-color);
    }
</style>